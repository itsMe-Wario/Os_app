<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dining Philosophers Simulation</title>
<style>
body {
    font-family: Arial, sans-serif;
  }

  .square {
    position:relative;
    width: 50px;
    height: 100px;
    margin: 50px auto;
  }
  .circle {
    position: relative;
    width: 400px; /* Adjust as needed */
    height: 400px; /* Adjust as needed */
    margin: 50px auto; /* Adjust as needed */
}

.philosopher {
    position: absolute;
    width: 100px; /* Adjust as needed */
    height: 100px; /* Adjust as needed */
    text-align: center;
}

#philosopher1 {
    top: 50px;
    left: 175px;
    
}

#philosopher2 {
    top: 250px;
    left: 450px;
}

#philosopher3 {
    top: 475px;
    left: 300px;
}

#philosopher4 {
    top: 475px;
    left: 90px;
}

#philosopher5 {
    top: 250px;
    left: -50px;
}


  .philosopher img {
    width:120px; /* Adjust the width as needed */
  height: auto; /* Maintain aspect ratio */
  border: 3px solid transparent; /* Add a transparent border around the image */
  border-radius: 10px; /* Add border radius for rounded corners */
}

/* Update border color based on philosopher status */
.philosopher.thinking img {
  border-color: rgb(183, 0, 0);
  background-color: rgb(183, 0, 0);
}

.philosopher.hungry img {
  border-color: rgb(155, 155, 252);
  background-color: rgb(155, 155, 252);
}

.philosopher.eating img {
  border-color: green;
  background-color: green;
}

.spoon {
    position: absolute;
    width: 20px; /* Adjust as needed */
    height: 20px; /* Adjust as needed */
    text-align: center;
}

#spoon1 {
    top: -265px;
    left: 33px;
    
}

#spoon2 {
    top: -140px;
    left: 200px;
}

#spoon3 {
    top: -47px;
    left: 155px;
}

#spoon4 {
    top: -47px;
    left: -50px;
}

#spoon5 {
    top: -140px;
    left:-90px;
}


  .spoon img {
  width: 60px; /* Adjust the width as needed */
  height: auto; /* Maintain aspect ratio */
  border: 3px solid transparent; /* Add a transparent border around the image */
  border-radius: 10px; /* Add border radius for rounded corners */
}

/* Update border color based on philosopher status */
.spoon.use img {
  border-color: green;
  background-color: green;
}

.spoon.nouse img{
  border-color: rgbrgb(183, 0, 0);
  background-color: rgb(183, 0, 0);
}

  .numbering{
    color: white;
    position: absolute;
    bottom: 70px;
    left: 15%;
    transform: translateX(-50%);
  }

  .numberingspoon{
    color: black;
    position: absolute;
    bottom: -41px;
    left: 55%;
    transform: translateX(-50%);
  }

  .numberingspoon5{
    color: black;
    position: absolute;
    bottom: -41px;
    right: -40px;
    transform: translateX(-50%);
  }

  .table {
    margin-top: 40px;
    text-align: center;
  }
  table {
    margin: 0 auto;
    border-collapse: collapse;
  }
  th, td {
    padding: 10px;
    border: 1px solid #000;
  }
  .red { background-color: rgb(183, 0, 0); }
  .green { background-color: green; }
  .blue { background-color: rgb(155, 155, 252); }
</style>
</head>
<body>
    <div id="circle" class="circle">
        <div class="philosopher" id="philosopher1">
            <img src="man_1.png" alt="Philosopher">
            <div class="numbering" id="numbering1">1</div>
        </div>
        <div class="philosopher" id="philosopher2">
            <img src="man_2.png" alt="Philosopher">
            <div class="numbering" id="numbering2">2</div>
        </div>
        <div class="philosopher" id="philosopher3">
            <img src="man_3.png" alt="Philosopher">
            <div class="numbering" id="numbering3">3</div>
        </div>
        <div class="philosopher" id="philosopher4">
            <img src="man_4.png" alt="Philosopher">
            <div class="numbering" id="numbering4">4</div>
        </div>
        <div class="philosopher" id="philosopher5">
            <img src="man_5.png" alt="Philosopher">
            <div class="numbering" id="numbering5">5</div>
        </div>
    </div>
    <div id="square" class="square">
      <div class="spoon" id="spoon1">
          <img src="spoon_bgremoved.png" alt="Spoon">
          <div class="numberingspoon" id="numbering6">1</div>
      </div>
      <div class="spoon" id="spoon2">
        <img src="spoon_bgremoved.png" alt="Spoon">
        <div class="numberingspoon" id="numbering7">2</div>
      </div>
      <div class="spoon" id="spoon3">
        <img src="spoon_bgremoved.png" alt="Spoon">
        <div class="numberingspoon" id="numbering8">3</div>
      </div>
      <div class="spoon" id="spoon4">
        <img src="spoon_bgremoved.png" alt="Spoon">
        <div class="numberingspoon" id="numbering9">4</div>
      </div>
      <div class="spoon" id="spoon5">
        <img src="spoon_bgremoved.png" alt="Spoon">
        <div class="numberingspoon5" id="numbering1">5</div>
      </div>
  </div>
    <button onclick="startSimulation()">Start</button>
    <button onclick="stopSimulation()">Stop</button>
    <div class="table">
        <h2>Dining Philosophers Table</h2>
        <table>
            <thead>
                <tr>
                    <th>Philosopher</th>
                    <th>Status</th>
                    <th>Spoon</th>
                    <th>Spoon Status</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</body>

<script>
  let semaphores = [1, 1, 1, 1, 1]; // 1 represents free spoon, 0 represents taken spoon
  let philosopherStatus = ["Thinking", "Thinking", "Thinking", "Thinking", "Thinking"];
  let stopFlag = false;
  let intervalId;

  function startSimulation() {
    stopFlag = false;
    intervalId = setInterval(() => {
      if (stopFlag) {
        clearInterval(intervalId);
        return;
      }
      for (let i = 0; i < 5; i++) {
        if (stopFlag) break;
        setTimeout(() => {
          testAndTakeForks(i) ;
        }, Math.random() * 3000);
      }
    }, 3000); // Adjust the interval as needed
  }

  function stopSimulation() {
    stopFlag = true;
  }

  function test(i) {
    if (semaphores[i] === 1 && semaphores[(i + 1) % 5] === 1) {
      return true;
    } else {
      return false;
    }
  }

  function testAndTakeForks(i) {
    if (test(i)) {
        takeForks(i); // Call takeForks function if test passes
    }
}

function takeForks(i) {
    if (stopFlag) return;
    philosopherStatus[i] = "Hungry";
    visualize();

    if (test(i)) {
        semaphores[i] = 0; // Take left spoon
        semaphores[(i + 1) % 5] = 0; // Take right spoon
        philosopherStatus[i] = "Eating";
        visualize();
        setTimeout(() => {
            releaseForks(i);
        }, 6000);
    }
}

function releaseForks(i) {
    if (stopFlag) return;
    semaphores[i] = 1; // Release left spoon
    semaphores[(i + 1) % 5] = 1; // Release right spoon
    philosopherStatus[i] = "Thinking";
    visualize();
}


  function visualize() {
  document.getElementById('tableBody').innerHTML = "";
  for (let i = 0; i < 5; i++) {
    let philosopherDiv = document.getElementById(`philosopher${i+1}`);
    let spoonDiv = document.getElementById(`spoon${i+1}`);
    philosopherDiv.className = `philosopher ${philosopherStatus[i].toLowerCase()}`; // Update class name based on status
    spoonDiv.className = `spoon ${semaphores[i] === 1 ? 'nouse' : 'use'}`; // Update spoon class based on status
    let tableRow = document.createElement('tr');
    tableRow.innerHTML = `
      <td>Philosopher ${i+1}</td>
      <td class="${philosopherStatus[i] === 'Thinking' ? 'red' : philosopherStatus[i] === 'Hungry' ? 'blue' : 'green'}">${philosopherStatus[i]}</td>
      <td>Spoon ${i+1}</td>
      <td>${semaphores[i]}</td>
    `;
    document.getElementById('tableBody').appendChild(tableRow);
  }
}

</script>
</body>
</html>